#好感度
#大小姐
@lady_affection_to_lv2 = 20
@lady_affection_to_lv3 = 55
@lady_affection_to_lv4 = 105
@lady_affection_to_lv5 = 175
@lady_affection_reduce = 40
#岛风
@shimakaze_affection_to_lv2 = 30
@shimakaze_affection_to_lv3 = 65
@shimakaze_affection_to_lv4 = 110
@shimakaze_affection_to_lv5 = 180
@shimakaze_affection_reduce = 40
#灰风
@gray_affection_to_lv2 = 25
@gray_affection_to_lv3 = 55
@gray_affection_to_lv4 = 90
@gray_affection_to_lv5 = 150
@gray_affection_reduce = 30
#涩狐狸
@Sharan_affection_to_lv2 = 30
@Sharan_affection_to_lv3 = 65
@Sharan_affection_to_lv4 = 110
@Sharan_affection_to_lv5 = 180
@Sharan_affection_reduce = 40
#泡泡
@bubbles_affection_to_lv2 = 30
@bubbles_affection_to_lv3 = 65
@bubbles_affection_to_lv4 = 105
@bubbles_affection_to_lv5 = 160
@bubbles_affection_reduce = 40
#总督
@governor_affection_to_lv2 = 35
@governor_affection_to_lv3 = 70
@governor_affection_to_lv4 = 105
@governor_affection_to_lv5 = 140
#科学家
@scientist_affection_to_lv2 = 55
@scientist_affection_to_lv3 = 110
@scientist_affection_to_lv4 = 165
@scientist_affection_to_lv5 = 220
#海军上将
@admiral_affection_to_lv2 = 25
@admiral_affection_to_lv3 = 50
@admiral_affection_to_lv4 = 75
@admiral_affection_to_lv5 = 100
#陆军将军
@general_affection_to_lv2 = 15
@general_affection_to_lv3 = 30
@general_affection_to_lv4 = 45
@general_affection_to_lv5 = 60
#统治者
@ruler_affection_to_lv2 = 30
@ruler_affection_to_lv3 = 60
@ruler_affection_to_lv4 = 95
@ruler_affection_to_lv5 = 130

# 添加自定义特殊好感特质领袖 的注意事项：
# 1. 需要写好该领袖特殊好感度特质
# 格式为leader_trait_(领袖类别)_(领袖名)_affection_trait_lv1~5
# 成品参考岛风和大小姐特质名
# 2. 需要写该领袖升2~5级好感度等级数值的全局变量
# 格式为@(领袖名)_affection_to_lv2~5
# 在scripted_variables文件夹里的文件也要写，数值以此文件为准
# 3. 需要写reset_(领袖名)_affection_level 函数
# 用于重设领袖好感度特质
# 4. 按情况可能要写add_(领袖名)_affection 函数
# 用于在通用情况增加领袖好感度

# 特殊好感度领袖通用函数：

# add_special_leader_affection_trait
# scope: leader
# PREV: country
# 输入值：LEADER；自定义领袖名字。该领袖对应的特质名必须按照上述格式书写
# LEADER_CLASS；领袖类别，同一领袖名定义拥有多个领袖类别
# 有效值：governor, scientist，admiral，general
# ！！！不支持 ruler 类别的领袖！！！
# MARRIED_FLAG：该特殊领袖结婚后设定的country flag，请自行定义
# 效果：根据好感度领袖添加特定的好感度特质

# add_special_leader_affection
# scope: leader
# PREV: country
# 输入值：LEADER，LEADER_CLASS，MARRIED_FLAG；同上
# 效果：增加特殊好感度领袖一点好感度

# add_special_scientist_affection_monthly
# scope: leader
# PREV: country
# 输入值：LEADER，LEADER_CLASS，MARRIED_FLAG；同上
# 效果：（每月使用）概率增加特殊好感度领袖（类别为科学家）一点好感度
# 注：该函数使用了伪随机算法

# remove_special_leader_affection_trait
# scope: leader
# 输入值：LEADER，LEADER_CLASS；同上
# 效果：删除指定领袖的指定领袖类别的所有特殊好感度特质

# reset_special_leader_affection_level
# scope: country
# 输入值：LEADER，MARRIED_FLAG；同上
# 效果：重设好感度等级变量。
# 请配合自定义reset_(领袖名)_affection_level 函数使用

# add_affection_only_special_leader
# scope: country
# 输入值：LEADER，MARRIED_FLAG；同上
# 效果：增加特殊领袖一点好感度，不自动改变领袖特质
# 请配合自定义add_(领袖名)_affection 函数使用

####################################################
# 普通好感度领袖通用函数（基本不用管）

# add_normal_leader_affection
# 输入值：LEADER_CLASS；领袖类别
# 有效值：governor, scientist，admiral，general
# ！！！不支持 ruler 类别的领袖！！！
# 效果：增加领袖一点好感

# remove_normal_leader_affection_trait
# 输入值：LEADER_CLASS；领袖类别
# 效果：删除指定领袖的指定领袖类别的所有好感度特质

# reset_normal_leader_affection_level
# 输入值：LEADER_CLASS；领袖类别
# 效果：重设该领袖的好感度等级和好感度特质

# scope: leader
# PREV: country
add_special_leader_affection_trait = {
	if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value >= @$LEADER$_affection_to_lv5 }}}
		if = {
			limit = { PREV = { has_country_flag = $MARRIED_FLAG$ }}
			add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv5
		}
		else = {
			add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv4_max
		}
	} else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value < @$LEADER$_affection_to_lv2 }}}
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv1
	} else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value < @$LEADER$_affection_to_lv3 }}}
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv2
	} else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value < @$LEADER$_affection_to_lv4 }}}
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv3
	} else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value < @$LEADER$_affection_to_lv5 }}}
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv4
	}
}

# scope: leader
# PREV: country
add_special_leader_affection = {
	PREV = { change_variable = { which = $LEADER$_affection value = 1 }}
	if = {
		limit = { 
			PREV = { OR = { 
				has_country_flag = $LEADER$_affection_max
				check_variable = { which = $LEADER$_affection_level value >= 5 }
			}}
		}
		break = yes
	}
	else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv2 }}}
		remove_$LEADER$_$LEADER_CLASS$_affection_trait = yes
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv2
		PREV = { set_variable = { which = $LEADER$_affection_level value = 2 }}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv3 }}}
		remove_$LEADER$_$LEADER_CLASS$_affection_trait = yes
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv3
		PREV = { set_variable = { which = $LEADER$_affection_level value = 3 }}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv4 }}}
		remove_$LEADER$_$LEADER_CLASS$_affection_trait = yes
		add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv4
		PREV = { set_variable = { which = $LEADER$_affection_level value = 4 }}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv5 }}}
		PREV = { set_country_flag = $LEADER$_affection_max }
		remove_$LEADER$_$LEADER_CLASS$_affection_trait = yes
		if = {
			limit = { PREV = { has_country_flag = $MARRIED_FLAG$ }}
			add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv5
			PREV = { set_variable = { which = $LEADER$_affection_level value = 5 }}
		}
		else = {
			add_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv4_max
		}
	}
}

# scope: country
reset_special_leader_affection_level = {
	if = {
		limit = { check_variable = { which = $LEADER$_affection value >= @$LEADER$_affection_to_lv5 }}
		if = {
			limit = { has_country_flag = $MARRIED_FLAG$ }
			set_variable = { which = $LEADER$_affection_level value = 5 }
		}
		else = { 
			set_variable = { which = $LEADER$_affection_level value = 4 }
			set_country_flag = $LEADER$_affection_max
		}
	} else = { 
		remove_country_flag = $LEADER$_affection_max 
		if = {
			limit = { check_variable = { which = $LEADER$_affection value >= @$LEADER$_affection_to_lv4 }}
			set_variable = { which = $LEADER$_affection_level value = 4 }
		}
		else_if = {
			limit = { check_variable = { which = $LEADER$_affection value >= @$LEADER$_affection_to_lv3 }}
			set_variable = { which = $LEADER$_affection_level value = 3 }
		}
		else_if = {
			limit = { check_variable = { which = $LEADER$_affection value >= @$LEADER$_affection_to_lv2 }}
			set_variable = { which = $LEADER$_affection_level value = 2 }
		}
		else_if = {
			limit = { check_variable = { which = $LEADER$_affection value < @$LEADER$_affection_to_lv2 }}
			set_variable = { which = $LEADER$_affection_level value = 1 }
			if = {
				limit = { check_variable = { which = $LEADER$_affection value < 1}}
				set_variable = { which = $LEADER$_affection value = 1 }
			}
		}
	}
}

# scope: country
add_affection_only_special_leader = {
	change_variable = { which = $LEADER$_affection value = 1 }
	if = {
		limit = { 
			OR = {
				has_country_flag = $LEADER$_affection_max
				check_variable = { which = $LEADER$_affection value > @$LEADER$_affection_to_lv5 }
			}
		}
		break = yes
	} else = {
		if = {
			limit = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv2 }}
			set_variable = { which = affection_level value = 2 }
		} 
		else_if = {
			limit = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv3 }}
			set_variable = { which = affection_level value = 3 }
		} 
		else_if = {
			limit = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv4 }}
			set_variable = { which = affection_level value = 4 }
		} 
		else_if = {
			limit = { check_variable = { which = $LEADER$_affection value = @$LEADER$_affection_to_lv5 }}
			set_country_flag = $LEADER$_affection_max
			if = {
				limit = { has_country_flag = $MARRIED_FLAG$ }
				set_variable = { which = affection_level value = 5 }
			} else = {
				set_variable = { which = affection_level value = 4 }
			}
		}
	}
}

# scope: fleet
# PREV scope: country
add_lady_fleet_affection_modifier = {
	if = {
		limit = { PREV = { check_variable = {
			which = lady_affection value >= @lady_affection_to_lv5
		}}}
		if = {
			limit = { PREV = { has_country_flag = married_wsg_lady }}
			add_modifier = { modifier = lady_affection_warship_lv5 days = -1 }
		} else = {
			add_modifier = { modifier = lady_affection_warship_lv4 days = -1 }
		}
	}
	else_if = {
		limit = { 
			PREV = { 
				check_variable = { which = lady_affection value > @lady_affection_to_lv2 }
				check_variable = { which = lady_affection value < @lady_affection_to_lv3 }
			}
		}
		add_modifier = { modifier = lady_affection_warship_lv2 days = -1 }
	}
	else_if = {
		limit = { PREV = { check_variable = {
			which = lady_affection value < @lady_affection_to_lv4
		}}}
		add_modifier = { modifier = lady_affection_warship_lv3 days = -1 }
	}
	else_if = {
		limit = { PREV = { check_variable = {
			which = lady_affection value < @lady_affection_to_lv5
		}}}
		add_modifier = { modifier = lady_affection_warship_lv4 days = -1 }
	}
}

# scope: country
# PREV: ship / fleet
add_lady_science_ship_affection = {
	change_variable = { which = lady_affection value = 1 }
	if = {
		limit = { 
			OR = { 
				has_country_flag = lady_affection_max
				check_variable = { which = lady_affection_level value >= 5 }
			}
		}
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv2 }}
		set_variable = { which = lady_affection_level value = 2 }
		PREV.leader = { 
			remove_special_leader_affection_trait = { LEADER_CLASS = scientist LEADER = lady }
			add_trait = leader_trait_scientist_lady_affection_lv2
		}
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv3 }}
		set_variable = { which = lady_affection_level value = 3 }
		PREV.leader = { 
			remove_special_leader_affection_trait = { LEADER_CLASS = scientist LEADER = lady }
			add_trait = leader_trait_scientist_lady_affection_lv3
		}
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv4 }}
		set_variable = { which = lady_affection_level value = 4 }
		PREV.leader = { 
			remove_special_leader_affection_trait = { LEADER_CLASS = scientist LEADER = lady }
			add_trait = leader_trait_scientist_lady_affection_lv4
		}
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv5 }}
		PREV.leader = { remove_special_leader_affection_trait = { LEADER_CLASS = scientist LEADER = lady } }
		set_country_flag = lady_affection_max
		if = {
			limit = { has_country_flag = married_wsg_lady }
			PREV.leader = { add_trait = leader_trait_scientist_lady_affection_lv5 }
			set_variable = { which = lady_affection_level value = 5 }
		}
		else = {
			PREV.leader = { add_trait = leader_trait_scientist_lady_affection_lv4_max }
		}
	}
}

# scope: country
add_lady_army_affection = {
	change_variable = { which = lady_affection value = 1 }
	if = {
		limit = { 
			OR = { 
				has_country_flag = lady_affection_max
				check_variable = { which = lady_affection_level value >= 5 }
			}
		}
		country_event = { id = wg_aft.13000 days = 1 }
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv2 }}
		set_variable = { which = lady_affection_level value = 2 }
		country_event = { id = wg_aft.13000 days = 1 }
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv3 }}
		set_variable = { which = lady_affection_level value = 3 }
		country_event = { id = wg_aft.13000 days = 1 }
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv4 }}
		set_variable = { which = lady_affection_level value = 4 }
		country_event = { id = wg_aft.13000 days = 1 }
	}
	else_if = {
		limit = { check_variable = { which = lady_affection value = @lady_affection_to_lv5 }}
		set_country_flag = lady_affection_max
		if = {
			limit = { has_country_flag = married_wsg_lady }
			country_event = { id = wg_aft.13000 days = 1 }
		}
	}
}

# scope: fleet
# PREV: country
add_lady_fleet_affection = {
	PREV = { change_variable = { which = lady_affection value = 1 }}
	if = {
		limit = { 
			PREV = { OR = { 
				has_country_flag = lady_affection_max
				check_variable = { which = lady_affection_level value >= 5 }
			}}
		}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = lady_affection value = @lady_affection_to_lv2 }}}
		remove_lady_fleet_affection_modifier = yes
		add_modifier = { modifier = lady_affection_warship_lv2 days = -1 }
		PREV = { set_variable = { which = lady_affection_level value = 2 }}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = lady_affection value = @lady_affection_to_lv3 }}}
		remove_lady_fleet_affection_modifier = yes
		add_modifier = { modifier = lady_affection_warship_lv3 days = -1 }
		PREV = { set_variable = { which = lady_affection_level value = 3 }}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = lady_affection value = @lady_affection_to_lv4 }}}
		remove_lady_fleet_affection_modifier = yes
		add_modifier = { modifier = lady_affection_warship_lv4 days = -1 }
		PREV = { set_variable = { which = lady_affection_level value = 4 }}
	}
	else_if = {
		limit = { PREV = { check_variable = { which = lady_affection value = @lady_affection_to_lv5 }}}
		PREV = { set_country_flag = lady_affection_max }
		if = {
			limit = { PREV = { has_country_flag = married_wsg_lady }}
			remove_lady_fleet_affection_modifier = yes
			add_modifier = { modifier = lady_affection_warship_lv5 days = -1 }
			PREV = { set_variable = { which = lady_affection_level value = 5 }}
		}
	}
}

# scope: leader
add_normal_leader_affection = {
	change_variable = { which = affection value = 1 }
	if = {
		limit = { 
			OR = { 
				has_leader_flag = affection_max
				check_variable = { which = affection value >= 5 }
			}
		}
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @$LEADER_CLASS$_affection_to_lv2 }
		}
		remove_normal_leader_affection_trait = { LEADER_CLASS = $LEADER_CLASS$ }
		remove_ruler_affection_trait = yes
		add_trait = leader_trait_$LEADER_CLASS$_affection_lv2
		add_ruler_trait = leader_trait_ruler_affection_lv2
		set_variable = { which = affection_level value = 2 }
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @$LEADER_CLASS$_affection_to_lv3 }
		}
		remove_normal_leader_affection_trait = { LEADER_CLASS = $LEADER_CLASS$ }
		remove_ruler_affection_trait = yes
		add_trait = leader_trait_$LEADER_CLASS$_affection_lv3
		add_ruler_trait = leader_trait_ruler_affection_lv3
		set_variable = { which = affection_level value = 3 }
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @$LEADER_CLASS$_affection_to_lv4 }
		}
		remove_normal_leader_affection_trait = { LEADER_CLASS = $LEADER_CLASS$ }
		remove_ruler_affection_trait = yes
		add_trait = leader_trait_$LEADER_CLASS$_affection_lv4
		add_ruler_trait = leader_trait_ruler_affection_lv4_max
		set_variable = { which = affection_level value = 4 }
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @$LEADER_CLASS$_affection_to_lv5 }
		}
		remove_normal_leader_affection_trait = { LEADER_CLASS = $LEADER_CLASS$ }
		remove_ruler_affection_trait = yes
		set_leader_flag = affection_max
		if = {
			limit = { has_leader_flag = married }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv5
			add_ruler_trait = leader_trait_ruler_affection_lv5
			set_variable = { which = affection_level value = 5 }
		}
		else = {
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv4_max
			add_ruler_trait = leader_trait_ruler_affection_lv4_max
		}
	}
}

# scope: leader
add_ruler_affection = {
	change_variable = { which = affection value = 1 }
	if = {
		limit = { 
			OR = { 
				has_leader_flag = affection_max
				check_variable = { which = affection value >= 5 }
			}
		}
		break = yes
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @ruler_affection_to_lv2 }
		}
		remove_ruler_affection_trait = yes
		add_trait = leader_trait_ruler_affection_lv2
		set_variable = { which = affection_level value = 2 }
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @ruler_affection_to_lv3 }
		}
		remove_ruler_affection_trait = yes
		add_trait = leader_trait_ruler_affection_lv3
		set_variable = { which = affection_level value = 3 }
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @ruler_affection_to_lv4 }
		}
		remove_ruler_affection_trait = yes
		add_trait = leader_trait_ruler_affection_lv4
		set_variable = { which = affection_level value = 4 }
	}
	else_if = {
		limit = {
			check_variable = { which = affection value = @ruler_affection_to_lv5 }
		}
		remove_ruler_affection_trait = yes
		set_leader_flag = affection_max
		if = {
			limit = { has_leader_flag = married }
			add_trait = leader_trait_ruler_affection_lv5
			set_variable = { which = affection_level value = 5 }
		}
		else = {
			add_trait = leader_trait_ruler_affection_lv4_max
		}
	}
}

add_lady_affection = {
	switch = {
		trigger = has_country_flag
		lady_governor_active = { 
			if = {
				limit = { exists = event_target:lady_governor }
				event_target:lady_governor = {
					add_special_leader_affection = { LEADER = lady LEADER_CLASS = governor MARRIED_FLAG = married_wsg_lady }
				}
			} else = {
				random_owned_leader = {
					limit = { has_leader_flag = wsg_lady_governor }
					add_special_leader_affection = { LEADER = lady LEADER_CLASS = governor MARRIED_FLAG = married_wsg_lady }
				}
			}
		}
		lady_warship_active = {
			if = {
				limit = { has_country_flag = lady_juggernaut }
				if = {
					limit = { exists = event_target:lady_warship_fleet }
					event_target:lady_warship_fleet = {
						add_lady_fleet_affection = yes
					}
				} else = {
					random_owned_fleet = {
						limit = { has_fleet_flag = lady_fleet2 }
						add_lady_fleet_affection = yes
					}
				}
			} else = {
				random_owned_leader = {
					limit = { has_leader_flag = wsg_lady_admiral }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = admiral MARRIED_FLAG = married_wsg_lady }
				}
			}
		}
		wsg_lady_army_active = {
			add_lady_army_affection = yes
		}
		wsg_lady_armed_science_active = {
			if = {
				limit = { exists = event_target:lady_survey_scientist }
				event_target:lady_survey_scientist = {
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_lady }
				}
			} else = {
				random_owned_leader = {
					limit = { has_leader_flag = wsg_lady_scientist }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_lady }
				}
			}
		}
		default = {
			change_variable = { which = lady_affection value = 1 }
			if = {
				limit = {
					check_variable = { which = lady_affection value = @lady_affection_to_lv5 }
				}
				set_country_flag = lady_affection_max
				if = {
					limit = { has_leader_flag = married }
					set_variable = { which = lady_affection_level value = 5 }
				} else = {
					set_variable = { which = lady_affection_level value = 4 }
				}
			} else = {
				remove_country_flag = lady_affection_max
				if = {
					limit = {
						check_variable = { which = affection value = @lady_affection_to_lv2 }
					}
					set_variable = { which = affection_level value = 2 }
				}
				else_if = {
					limit = {
						check_variable = { which = affection value = @lady_affection_to_lv3 }
					}
					set_variable = { which = affection_level value = 3 }
				}
				else_if = {
					limit = {
						check_variable = { which = affection value = @lady_affection_to_lv4 }
					}
					set_variable = { which = affection_level value = 4 }
				}
			}
		}
	}
}

###############################
#  增加好感度
###############################
# scope: leader
add_scientist_affection_monthly = {
	random_list = {
		1 = {
			modifier = {
				check_variable = { which = months_no_affection value >= 8 }
				add = 4
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 10 }
				add = 4
			}
			set_variable = { which = months_no_affection value = 0 }
			add_normal_leader_affection = { LEADER_CLASS = scientist }
		}
		14 = {
			modifier = {
				check_variable = { which = months_no_affection value >= 2 }
				add = -3
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 4 }
				add = -2
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 6 }
				add = -5
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 12 }
				factor = 0
			}
			change_variable = { which = months_no_affection value = 1 }
		}
	}
}

add_scientist_affection_arch = {
	random_list = {
		1 = {
			modifier = {
				check_variable = { which = clues_no_affection value >= 7 }
				add = -3
			}
			switch = {
				trigger = has_leader_flag
				wsg_lady_leader = {
					owner = { event_target:lady_survey_scientist = {
						add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_lady }
					}}
				}
				wsg_shimakaze_leader = {
					owner = { event_target:shimakaze_scientist = { 
						add_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_shimakaze }
					}}
				}
				default = {
					add_normal_leader_affection = { LEADER_CLASS = scientist }
				}
			}
			set_variable = { which = clues_no_affection value = 0 }
		}
		7 = {
			modifier = {
				check_variable = { which = clues_no_affection value >= 1 }
				add = -1
			}
			modifier = {
				check_variable = { which = clues_no_affection value >= 3 }
				add = -2
			}
			modifier = {
				check_variable = { which = clues_no_affection value >= 5 }
				add = -3
			}
			modifier = {
				check_variable = { which = clues_no_affection value >= 8 }
				factor = 0
			}
			change_variable = { which = clues_no_affection value = $CLUES$ }
		}
	}
}

# scope: leader
# PREV: country
add_special_scientist_affection_monthly = {
	random_list = {
		1 = {
			modifier = {
				check_variable = { which = months_no_affection value >= 8 }
				add = 4
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 10 }
				add = 4
			}
			set_variable = { which = months_no_affection value = 0 }
			add_special_leader_affection = { LEADER = $LEADER$ LEADER_CLASS = $LEADER_CLASS$ MARRIED_FLAG = $MARRIED_FLAG$ }
		}
		14 = {
			modifier = {
				check_variable = { which = months_no_affection value >= 2 }
				add = -3
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 4 }
				add = -2
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 6 }
				add = -5
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 12 }
				factor = 0
			}
			change_variable = { which = months_no_affection value = 1 }
		}
	}
}

add_ruler_affection_monthly = {
	random_list = {
		1 = {
			set_variable = { which = months_no_affection value = 0 }
			add_ruler_affection = yes
		}
		24 = {
			modifier = {
				check_variable = { which = months_no_affection value >= 2 }
				add = -5
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 4 }
				add = -5
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 6 }
				add = -5
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 8 }
				add = -5
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 10 }
				add = -4
			}
			modifier = {
				check_variable = { which = months_no_affection value >= 12 }
				factor = 0
			}
			change_variable = { which = months_no_affection value = 1 }
		}
	}
}

remove_special_leader_affection_trait = {
	remove_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv1
	remove_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv2
	remove_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv3 
	remove_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv4 
	remove_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv4_max 
	remove_trait = leader_trait_$LEADER_CLASS$_$LEADER$_affection_lv5 
}

remove_normal_leader_affection_trait = {
	remove_trait = leader_trait_$LEADER_CLASS$_affection_lv1
	remove_trait = leader_trait_$LEADER_CLASS$_affection_lv2
	remove_trait = leader_trait_$LEADER_CLASS$_affection_lv3 
	remove_trait = leader_trait_$LEADER_CLASS$_affection_lv4 
	remove_trait = leader_trait_$LEADER_CLASS$_affection_lv4_max 
	remove_trait = leader_trait_$LEADER_CLASS$_affection_lv5 
}

# scope: fleet
remove_lady_fleet_affection_modifier = {
	remove_modifier = lady_affection_warship_lv2
	remove_modifier = lady_affection_warship_lv3
	remove_modifier = lady_affection_warship_lv4
	remove_modifier = lady_affection_warship_lv5
}

# scope: leader
remove_ruler_affection_trait = {
	remove_ruler_trait = leader_trait_ruler_affection_lv1 
	remove_ruler_trait = leader_trait_ruler_affection_lv2 
	remove_ruler_trait = leader_trait_ruler_affection_lv3 
	remove_ruler_trait = leader_trait_ruler_affection_lv4 
	remove_ruler_trait = leader_trait_ruler_affection_lv4_max 
	remove_ruler_trait = leader_trait_ruler_affection_lv5 
}

reset_normal_leader_affection_level = {
	remove_normal_leader_affection_trait = { LEADER_CLASS = $LEADER_CLASS$ }
	if = {
		limit = { check_variable = { which = affection value >= @$LEADER_CLASS$_affection_to_lv5 }}
		if = {
			limit = { has_leader_flag = married }
			set_variable = { which = affection_level value = 5 }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv5
		}
		else = { 
			set_variable = { which = affection_level value = 4 }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv4_max
		}
		set_leader_flag = affection_max
	}
	else = { 
		remove_leader_flag = affection_max 
		if = {
			limit = { check_variable = { which = affection value >= @$LEADER_CLASS$_affection_to_lv4 }}
			set_variable = { which = affection_level value = 4 }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv4
			break = yes
		}
		if = {
			limit = { check_variable = { which = affection value >= @$LEADER_CLASS$_affection_to_lv3 }}
			set_variable = { which = affection_level value = 3 }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv3
			break = yes
		}
		if = {
			limit = { check_variable = { which = affection value >= @$LEADER_CLASS$_affection_to_lv2 }}
			set_variable = { which = affection_level value = 2 }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv2
			break = yes
		}
		if = {
			limit = { check_variable = { which = affection value < @$LEADER_CLASS$_affection_to_lv2 }}
			set_variable = { which = affection_level value = 1 }
			add_trait = leader_trait_$LEADER_CLASS$_affection_lv1
			if = {
				limit = { check_variable = { which = affection value < 1}}
				set_variable = { which = affection value = 1 }
			}
			break = yes
		}
	}
}

reset_ruler_affection_level = {
	remove_ruler_affection_trait = yes
	if = {
		limit = { check_variable = { which = affection value >= @ruler_affection_to_lv5 }}
		if = {
			limit = { has_leader_flag = married }
			set_variable = { which = affection_level value = 5 }
			add_trait = leader_trait_ruler_affection_lv5
		}
		else = { 
			set_variable = { which = affection_level value = 4 }
			add_trait = leader_trait_ruler_affection_lv4_max
		}
		set_leader_flag = affection_max
	}
	else = { 
		remove_leader_flag = affection_max 
		if = {
			limit = { check_variable = { which = affection value >= @ruler_affection_to_lv4 }}
			set_variable = { which = affection_level value = 4 }
			add_trait = leader_trait_ruler_affection_lv4
			break = yes
		}
		if = {
			limit = { check_variable = { which = affection value >= @ruler_affection_to_lv3 }}
			set_variable = { which = affection_level value = 3 }
			add_trait = leader_trait_ruler_affection_lv3
			break = yes
		}
		if = {
			limit = { check_variable = { which = affection value >= @ruler_affection_to_lv2 }}
			set_variable = { which = affection_level value = 2 }
			add_trait = leader_trait_ruler_affection_lv2
			break = yes
		}
		if = {
			limit = { check_variable = { which = affection value < @ruler_affection_to_lv2 }}
			set_variable = { which = affection_level value = 1 }
			add_trait = leader_trait_ruler_affection_lv1
			if = {
				limit = { check_variable = { which = affection value < 1}}
				set_variable = { which = affection value = 1 }
			}
			break = yes
		}
	}
}

reset_lady_affection_level = {
	switch = {
		trigger = has_country_flag
		lady_governor_active = { 
			if = {
				limit = { exists = event_target:lady_governor }
				event_target:lady_governor = {
					remove_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = governor }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = governor MARRIED_FLAG = married_wsg_lady }
					set_lady_portrait = yes
				}
			} else = {
				random_owned_leader = {
					limit = { has_leader_flag = wsg_lady_governor }
					remove_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = governor }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = governor MARRIED_FLAG = married_wsg_lady }
					set_lady_portrait = yes
				}
			}
		}
		lady_warship_active = {
			if = {
				limit = { has_country_flag = lady_juggernaut }
				remove_lady_fleet_affection_modifier = yes
				if = {
					limit = { exists = event_target:lady_warship_fleet }
					event_target:lady_warship_fleet = {
						add_lady_fleet_affection_modifier = yes
					}
				} else = {
					random_owned_fleet = {
						limit = { has_fleet_flag = lady_fleet2 }
						add_lady_fleet_affection_modifier = yes
					}
				}
			} else = {
			random_owned_leader = {
				limit = { has_leader_flag = wsg_lady_admiral }
					remove_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = admiral }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = admiral MARRIED_FLAG = married_wsg_lady }
					set_lady_portrait = yes
				}
			}
		}
		wsg_lady_armed_science_active = {
			if = {
				limit = { exists = event_target:lady_survey_scientist }
				event_target:lady_survey_scientist = {
					remove_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_lady }
					set_lady_portrait = yes
				}
			} else = {
				random_owned_leader = {
					limit = { has_leader_flag = wsg_lady_scientist }
					remove_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist }
					add_special_leader_affection_trait = { LEADER = lady LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_lady }
					set_lady_portrait = yes
				}
			}
		}
	}
	if = {
		limit = { check_variable = { which = lady_affection value >= @lady_affection_to_lv5 }}
		if = {
			limit = { has_country_flag = married_wsg_lady }
			if = {
				limit = { 
					NOT = { check_variable = { which = lady_affection_level value = 5 }}
					has_country_flag = wsg_lady_army_active
				}
				country_event = { id = wg_aft.13000 }
			}
			set_variable = { which = lady_affection_level value = 5 }
		}
		else = { 
			set_variable = { which = lady_affection_level value = 4 }
			set_country_flag = lady_affection_max
		}
	} else = { 
		remove_country_flag = lady_affection_max 
		if = {
			limit = { check_variable = { which = lady_affection value >= @lady_affection_to_lv4 }}
			set_variable = { which = lady_affection_level value = 4 }
		}
		else_if = {
			limit = { check_variable = { which = lady_affection value >= @lady_affection_to_lv3 }}
			if = {
				limit = { 
					NOT = { check_variable = { which = lady_affection_level value = 3 }}
					has_country_flag = wsg_lady_army_active
				}
				country_event = { id = wg_aft.13000 }
			}
			set_variable = { which = lady_affection_level value = 3 }
		}
		else_if = {
			limit = { check_variable = { which = lady_affection value >= @lady_affection_to_lv2 }}
			set_variable = { which = lady_affection_level value = 2 }
		}
		else_if = {
			limit = { check_variable = { which = lady_affection value < @lady_affection_to_lv2 }}
			if = {
				limit = { 
					NOT = { check_variable = { which = lady_affection_level value = 1 }}
					has_country_flag = wsg_lady_army_active
				}
				country_event = { id = wg_aft.13000 }
			}
			set_variable = { which = lady_affection_level value = 1 }
			if = {
				limit = { check_variable = { which = lady_affection value < 1}}
				set_variable = { which = lady_affection value = 1 }
			}
		}
	}
}

calculate_affection_to_level_up = {
	switch = {
		trigger = leader_class
		governor = { 
			if = {
				limit = { check_variable = { which = affection_level value < 2 }}
				set_variable = { which = affection_to_level_up value = @governor_affection_to_lv2 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 2 }}
				set_variable = { which = affection_to_level_up value = @governor_affection_to_lv3 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 3 }}
				set_variable = { which = affection_to_level_up value = @governor_affection_to_lv4 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 4 }}
				if = {
					limit = { has_leader_flag = affection_max }
					set_variable = { which = affection_to_level_up value = 0 }
				}
				else = { set_variable = { which = affection_to_level_up value = @governor_affection_to_lv5 }}
			}
		}
		scientist = { 
			if = {
				limit = { check_variable = { which = affection_level value < 2 }}
				set_variable = { which = affection_to_level_up value = @scientist_affection_to_lv2 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 2 }}
				set_variable = { which = affection_to_level_up value = @scientist_affection_to_lv3 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 3 }}
				set_variable = { which = affection_to_level_up value = @scientist_affection_to_lv4 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 4 }}
				if = {
					limit = { has_leader_flag = affection_max }
					set_variable = { which = affection_to_level_up value = 0 }
				}
				else = { set_variable = { which = affection_to_level_up value = @scientist_affection_to_lv5 }}
			}
		}
		admiral = { 
			if = {
				limit = { check_variable = { which = affection_level value < 2 }}
				set_variable = { which = affection_to_level_up value = @admiral_affection_to_lv2 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 2 }}
				set_variable = { which = affection_to_level_up value = @admiral_affection_to_lv3 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 3 }}
				set_variable = { which = affection_to_level_up value = @admiral_affection_to_lv4 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 4 }}
				if = {
					limit = { has_leader_flag = affection_max }
					set_variable = { which = affection_to_level_up value = 0 }
				}
				else = { set_variable = { which = affection_to_level_up value = @admiral_affection_to_lv5 }}
			}
		}
		general = { 
			if = {
				limit = { check_variable = { which = affection_level value < 2 }}
				set_variable = { which = affection_to_level_up value = @general_affection_to_lv2 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 2 }}
				set_variable = { which = affection_to_level_up value = @general_affection_to_lv3 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 3 }}
				set_variable = { which = affection_to_level_up value = @general_affection_to_lv4 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 4 }}
				if = {
					limit = { has_leader_flag = affection_max }
					set_variable = { which = affection_to_level_up value = 0 }
				}
				else = { set_variable = { which = affection_to_level_up value = @general_affection_to_lv5 }}
			}
		}
		ruler = {
			if = {
				limit = { check_variable = { which = affection_level value < 2 }}
				set_variable = { which = affection_to_level_up value = @ruler_affection_to_lv2 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 2 }}
				set_variable = { which = affection_to_level_up value = @ruler_affection_to_lv3 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 3 }}
				set_variable = { which = affection_to_level_up value = @ruler_affection_to_lv4 }
			}
			else_if = {
				limit = { check_variable = { which = affection_level value = 4 }}
				if = {
					limit = { has_leader_flag = affection_max }
					set_variable = { which = affection_to_level_up value = 0 }
				}
				else = { set_variable = { which = affection_to_level_up value = @ruler_affection_to_lv5 }}
			}
		}
	}
	subtract_variable = { which = affection_to_level_up value = affection }
	if = {
		limit = { check_variable = { which = affection_to_level_up value < 0 }}
		set_variable = { which = affection_to_level_up value = 0 }
	}
}

# scope: country
calculate_special_leader_affection_to_level_up = {
	if = {
		limit = { check_variable = { which = $LEADER$_affection_level value < 2 }}
		set_variable = { which = $LEADER$_affection_to_level_up value = @$LEADER$_affection_to_lv2 }
	}
	else_if = {
		limit = { check_variable = { which = $LEADER$_affection_level value = 2 }}
		set_variable = { which = $LEADER$_affection_to_level_up value = @$LEADER$_affection_to_lv3 }
	}
	else_if = {
		limit = { check_variable = { which = $LEADER$_affection_level value = 3 }}
		set_variable = { which = $LEADER$_affection_to_level_up value = @$LEADER$_affection_to_lv4 }
	}
	else_if = {
		limit = { check_variable = { which = $LEADER$_affection_level value = 4 }}
		if = {
			limit = { has_country_flag = $LEADER$_affection_max }
			set_variable = { which = $LEADER$_affection_to_level_up value = 0 }
		}
		else = { set_variable = { which = $LEADER$_affection_to_level_up value = @$LEADER$_affection_to_lv5 }}
	}
	subtract_variable = { which = $LEADER$_affection_to_level_up value = $LEADER$_affection }
	if = {
		limit = { check_variable = { which = $LEADER$_affection_to_level_up value < 0 }}
		set_variable = { which = affection_to_level_up value = 0 }
	}
}

###############################
#  special use
###############################
add_scientist_affection_no_check = {
	switch = {
		trigger = has_leader_flag
		wsg_shimakaze_scientist = { owner = { change_variable = { which = shimakaze_affection value = 1 }}}
		wsg_lady_leader = { owner = { change_variable = { which = lady_affection value = 1 }}}
		default = { change_variable = { which = affection value = 1 }}
	}
}

###############################
#  岛风好感度使用
###############################
# scope: leader
add_shimakaze_affection = {
	switch = {
		trigger = has_country_flag
		wsg_shimakaze_governor = {
			add_special_leader_affection = { LEADER = shimakaze LEADER_CLASS = governor MARRIED_FLAG = married_wsg_shimakaze }
		}
		wsg_shimakaze_scientist = {
			add_special_leader_affection = { LEADER = shimakaze LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_shimakaze }
		}
		wsg_shimakaze_admiral = {
			add_special_leader_affection = { LEADER = shimakaze LEADER_CLASS = admiral MARRIED_FLAG = married_wsg_shimakaze }
		}
		wsg_shimakaze_general = {
			add_special_leader_affection = { LEADER = shimakaze LEADER_CLASS = general MARRIED_FLAG = married_wsg_shimakaze }
		}
		default = {
			add_affection_only_special_leader = { LEADER = shimakaze MARRIED_FLAG = married_wsg_shimakaze }
		}
	}
}

# scope: country
reset_shimakaze_affection_level = {
	switch = {
		trigger = has_country_flag
		wsg_shimakaze_governor_active = { 
			event_target:shimakaze_governor = {
				remove_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = governor }
				add_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = governor MARRIED_FLAG = married_wsg_shimakaze }
			}
		}
		wsg_shimakaze_scientist_active = { 
			event_target:shimakaze_scientist = {
				remove_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = scientist }
				add_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = scientist MARRIED_FLAG = married_wsg_shimakaze }
			}
		}
		wsg_shimakaze_admiral_active = { 
			event_target:shimakaze_admiral = {
				remove_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = admiral }
				add_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = admiral MARRIED_FLAG = married_wsg_shimakaze }
			}
		}
		wsg_shimakaze_general_active = { 
			event_target:shimakaze_general = {
				remove_special_leader_affection_trait = { LEADER = shimakaze LEADER_CLASS = general }
				add_special_leader_affection_trait = { LEADER= shimakaze LEADER_CLASS = general MARRIED_FLAG = married_wsg_shimakaze }
			}
		}
	}
	reset_special_leader_affection_level = { LEADER = shimakaze MARRIED_FLAG = married_wsg_shimakaze }
}

#####################################################################
#  灰风好感度
#####################################################################

reset_gray_affection_level = {
	switch = {
		trigger = has_country_flag
		gray_governor_active = { 
			if = {
				limit = { exists = event_target:gray_governor }
				event_target:gray_governor = {
					remove_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = governor } 
					add_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = governor MARRIED_FLAG = married_gray }
				}
			} else = {
				random_owned_leader = {
					limit = { has_leader_flag = gray_governor }
					remove_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = governor } 
					add_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = governor MARRIED_FLAG = married_gray }
				}
			}
		}
		gray_warship_active = { 
			if = {
				limit = { exists = event_target:huifeng_leader_admiral }
				event_target:huifeng_leader_admiral = {
					remove_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = admiral }
					add_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = admiral MARRIED_FLAG = married_gray }
				}
			} else = {
				random_owned_leader = { 
					limit = { has_leader_flag = gray_admiral }
					remove_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = admiral }
					add_special_leader_affection_trait = { LEADER = gray LEADER_CLASS = admiral MARRIED_FLAG = married_gray }
				}
			}
		}
	}
	reset_special_leader_affection_level = { LEADER = gray MARRIED_FLAG = married_gray }
}

#####################################################################
#  涩狐狸好感度
#####################################################################

# scope:country
# 效果：增加涩狐狸一点好感度
add_Sharan_affection = {
	switch = {
		trigger = has_country_flag
		swgs_Sharan_governor_active = {
			add_special_leader_affection = { LEADER = Sharan LEADER_CLASS = governor MARRIED_FLAG = married_swgs_Sharan }
		}
		swgs_Sharan_admiral_active = {
			add_special_leader_affection = { LEADER = Sharan LEADER_CLASS = admiral MARRIED_FLAG = married_swgs_Sharan }
		}
		default = {
			add_affection_only_special_leader = { LEADER = Sharan MARRIED_FLAG = married_swgs_Sharan }
		}
	}
}

# scope: country
# 效果：重置涩狐狸好感度等级
reset_Sharan_affection_level = {
	switch = {
		trigger = has_country_flag
		swgs_Sharan_governor_active = { 
			event_target:Sharan_governor = {
				remove_special_leader_affection_trait = { LEADER = Sharan LEADER_CLASS = governor }
				add_special_leader_affection_trait = { LEADER = Sharan LEADER_CLASS = governor MARRIED_FLAG = married_swgs_Sharan }
			}
		}
		swgs_Sharan_admiral_active = { 
			event_target:Sharan_admiral = {
				remove_special_leader_affection_trait = { LEADER = Sharan LEADER_CLASS = admiral }
				add_special_leader_affection_trait = { LEADER = Sharan LEADER_CLASS = admiral MARRIED_FLAG = married_swgs_Sharan }
			}
		}
	}
	reset_special_leader_affection_level = { LEADER = bubbles MARRIED_FLAG = married_bubbles }
}

# scope: country
# 效果：重置泡泡好感度等级
reset_bubbles_affection_level = {
	if = {
		limit = { has_country_flag = can_communicate_bubbles }
		random_owned_leader = {
			limit = { has_leader_flag = bubbles_admiral }
			remove_special_leader_affection_trait = { LEADER = bubbles LEADER_CLASS = admiral }
			add_special_leader_affection_trait = { LEADER = bubbles LEADER_CLASS = admiral MARRIED_FLAG = married_bubbles }
		}
	} else_if = {
		limit = { has_country_flag = modified_bubbles }
		switch = {
			trigger = has_country_flag
			bubbles_governor_active = { 
				random_owned_leader = {
					limit = { has_leader_flag = bubbles_governor }
					remove_special_leader_affection_trait = { LEADER = bubbles LEADER_CLASS = governor }
					add_special_leader_affection_trait = { LEADER = bubbles LEADER_CLASS = governor MARRIED_FLAG = married_bubbles }
				}
			}
			bubbles_warship_active = { 
				random_owned_leader = {
					limit = { has_leader_flag = bubbles_admiral }
					remove_special_leader_affection_trait = { LEADER = bubbles LEADER_CLASS = admiral }
					add_special_leader_affection_trait = { LEADER = bubbles LEADER_CLASS = admiral MARRIED_FLAG = married_bubbles }
				}
			}
		}
	}
	reset_special_leader_affection_level = { LEADER = bubbles MARRIED_FLAG = married_bubbles }
}
###############################
#  移除负面特性
###############################
# scope: leader
remove_governor_negative_trait = {
	remove_trait = leader_trait_corrupt 
	remove_trait = leader_trait_stubborn 
	remove_trait = leader_trait_substance_abuser 
	remove_trait = leader_trait_arrested_development
}

# scope: leader
remove_scientist_negative_trait = {
	remove_trait = leader_trait_paranoid 
	remove_trait = leader_trait_traumatized 
	remove_trait = leader_trait_stubborn
	remove_trait = leader_trait_substance_abuser 
	remove_trait = leader_trait_arrested_development
}

# scope: leader
remove_admiral_negative_trait = {
	remove_trait = leader_trait_lethargic
	remove_trait = leader_trait_nervous
	remove_trait = leader_trait_stubborn
	remove_trait = leader_trait_substance_abuser
	remove_trait = leader_trait_arrested_development
}

# scope: leader
remove_general_negative_trait = {
	remove_trait = leader_trait_armchair_commander
	remove_trait = leader_trait_stubborn 
	remove_trait = leader_trait_substance_abuser 
	remove_trait = leader_trait_arrested_development 
}

# scope: leader
remove_ruler_negative_trait = {
	remove_trait = leader_trait_stubborn 
	remove_trait = leader_trait_substance_abuser 
	remove_trait = leader_trait_arrested_development 
}

# scope: leader
check_and_remove_normal_leader_affection_traits = {
	remove_normal_leader_affection_trait = { LEADER_CLASS = governor }
	remove_normal_leader_affection_trait = { LEADER_CLASS = scientist }
	remove_normal_leader_affection_trait = { LEADER_CLASS = admiral }
	remove_normal_leader_affection_trait = { LEADER_CLASS = general }
	remove_ruler_affection_trait = yes
}